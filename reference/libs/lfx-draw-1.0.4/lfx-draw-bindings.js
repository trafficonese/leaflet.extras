LeafletWidget.methods.addDrawToolbar=function(e,a,r){function t(e,a,r,t,o){return function(n){if(HTMLWidgets.shinyMode){var i=$.extend({id:a,category:o,".nonce":Math.random()},null!==r?{group:r}:null,n.target._latlngs?{latlngs:n.target._latlngs.flat()}:n.target._latlng,void 0!==n.target._mRadius?{radius:n.target._mRadius}:{});Shiny.onInputChange(e+"_"+t,i)}}}(function(){var o,n=this;if(n.drawToolbar&&(n.drawToolbar.remove(n),delete n.drawToolbar),e){if(!(o=n.layerManager.getLayer("geojson",e)))throw"GeoJSON layer with ID "+e+" not Found";n._editableGeoJSONLayerId=e}else a||(a="editableFeatureGroup"),o=n.layerManager.getLayerGroup(a,!0),n._editableFeatureGroupName=a;if(r&&r.draw&&r.draw.marker&&r.draw.marker.markerIcon&&r.draw.marker.markerIconFunction&&(r.draw.marker.icon=r.draw.marker.markerIconFunction(r.draw.marker.markerIcon)),!$.isEmptyObject(r.edit)){var i={};r.edit.remove||(i.remove=!1),r.edit.edit?$.isEmptyObject(r.edit.selectedPathOptions)||(i.edit={},i.edit.selectedPathOptions=r.edit.selectedPathOptions):i.edit=!1,$.isEmptyObject(r.edit.poly)||(i.poly=r.edit.poly),i.featureGroup=o,r.edit=i}if(r&&r.toolbar){var d=r.toolbar,l=L.drawLocal.draw.toolbar;L.drawLocal.draw.toolbar.buttons=Object.assign({},l.buttons,d.buttons),L.drawLocal.draw.toolbar.actions=Object.assign({},l.actions,d.actions),L.drawLocal.draw.toolbar.finish=Object.assign({},l.finish,d.finish),L.drawLocal.draw.toolbar.undo=Object.assign({},l.undo,d.undo)}if(r&&r.handlers){var s=r.handlers,u=L.drawLocal.draw.handlers;L.drawLocal.draw.handlers.circle=Object.assign({},u.circle,s.circle),L.drawLocal.draw.handlers.circlemarker=Object.assign({},u.circlemarker,s.circlemarker),L.drawLocal.draw.handlers.marker=Object.assign({},u.marker,s.marker),L.drawLocal.draw.handlers.polygon=Object.assign({},u.polygon,s.polygon),L.drawLocal.draw.handlers.polyline=Object.assign({},u.polyline,s.polyline),L.drawLocal.draw.handlers.rectangle=Object.assign({},u.rectangle,s.rectangle)}n.drawToolbar=new L.Control.Draw(r),n.drawToolbar.addTo(n),n.on(L.Draw.Event.DRAWSTART,(function(e){HTMLWidgets.shinyMode&&Shiny.onInputChange(n.id+"_draw_start",{feature_type:e.layerType,nonce:Math.random()})})),n.on(L.Draw.Event.DRAWSTOP,(function(e){HTMLWidgets.shinyMode&&Shiny.onInputChange(n.id+"_draw_stop",{feature_type:e.layerType,nonce:Math.random()})})),n.on(L.Draw.Event.CREATED,(function(e){r.draw.singleFeature&&o.getLayers().length>0&&o.clearLayers();var i=e.layer;o.addLayer(i);var d=L.stamp(i);if(i.feature={type:"Feature",properties:{_leaflet_id:d,feature_type:e.layerType}},"function"==typeof i.getRadius&&(i.feature.properties.radius=i.getRadius()),HTMLWidgets.shinyMode){var l=e.layerType;["rectangle","polygon","circle"].includes(l)?l="shape":"circlemarker"===l&&(l="marker"),i.on("click",t(n.id,d,a,l+"_draw_click",l),n),i.on("mouseover",t(n.id,d,a,l+"_draw_mouseover",l),n),i.on("mouseout",t(n.id,d,a,l+"_draw_mouseout",l),n),Shiny.onInputChange(n.id+"_draw_new_feature",i.toGeoJSON(),{priority:"event"}),Shiny.onInputChange(n.id+"_draw_all_features",o.toGeoJSON(),{priority:"event"})}})),n.on(L.Draw.Event.EDITSTART,(function(){HTMLWidgets.shinyMode&&Shiny.onInputChange(n.id+"_draw_editstart",!0,{priority:"event"})})),n.on(L.Draw.Event.EDITSTOP,(function(){HTMLWidgets.shinyMode&&Shiny.onInputChange(n.id+"_draw_editstop",!0,{priority:"event"})})),n.on(L.Draw.Event.EDITED,(function(e){var a=e.layers;a.eachLayer((function(e){var a=L.stamp(e);e.feature||(e.feature={type:"Feature"}),e.feature.properties||(e.feature.properties={}),e.feature.properties._leaflet_id=a,e.feature.properties.layerId=e.options.layerId,"function"==typeof e.getRadius&&(e.feature.properties.radius=e.getRadius())})),HTMLWidgets.shinyMode&&(Shiny.onInputChange(n.id+"_draw_edited_features",a.toGeoJSON(),{priority:"event"}),Shiny.onInputChange(n.id+"_draw_all_features",o.toGeoJSON(),{priority:"event"}))})),n.on(L.Draw.Event.DELETESTART,(function(){HTMLWidgets.shinyMode&&Shiny.onInputChange(n.id+"_draw_deletestart",!0,{priority:"event"})})),n.on(L.Draw.Event.DELETESTOP,(function(){HTMLWidgets.shinyMode&&Shiny.onInputChange(n.id+"_draw_deletestop",!0,{priority:"event"})})),n.on(L.Draw.Event.DELETED,(function(e){var a=e.layers;a.eachLayer((function(e){var a=L.stamp(e);e.feature||(e.feature={type:"Feature"}),e.feature.properties||(e.feature.properties={}),e.feature.properties._leaflet_id=a,e.feature.properties.layerId=e.options.layerId,"function"==typeof e.getRadius&&(e.feature.properties.radius=e.getRadius())})),HTMLWidgets.shinyMode&&(Shiny.onInputChange(n.id+"_draw_deleted_features",a.toGeoJSON(),{priority:"event"}),Shiny.onInputChange(n.id+"_draw_all_features",o.toGeoJSON(),{priority:"event"}))}))}).call(this)},LeafletWidget.methods.removeDrawToolbar=function(e){(function(){var a=this;a.drawToolbar&&(a.drawToolbar.remove(a),delete a.drawToolbar),a._editableFeatureGroupName&&e&&a.layerManager.getLayerGroup(a._editableFeatureGroupName,!1).clearLayers(),a._editableFeatureGroupName=null,a._editableGeoJSONLayerId&&e&&a.layerManager.removeLayer("geojson",a._editableGeoJSONLayerId),a._editableGeoJSONLayerId=null}).call(this)},LeafletWidget.methods.getDrawnItems=function(){var e,a=this;return a._editableGeoJSONLayerId?e=a.layerManager.getLayer("geojson",a._editableGeoJSONLayerId):a._editableFeatureGroupName&&(e=a.layerManager.getLayerGroup(a._editableFeatureGroupName,!1)),e?e.toGeoJSON():null};